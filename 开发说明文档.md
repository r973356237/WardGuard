# 科室管理系统开发说明文档

## 一、系统概述
本科室管理系统旨在提供一个全面的解决方案，实现对物资、药品、人员、体检信息等的有效管理。系统具备常规的登录、注册、权限管理功能，同时将用户的所有操作记录以时间轴形式展示。主界面通过图表直观呈现各类数据。

## 二、技术栈
### 前端
1. **React**：用于构建用户界面的JavaScript库，提供高效的组件化开发模式。
2. **Ant Design 5.0 UI库**：提供丰富、美观且易用的UI组件，加快前端开发速度。

### 后端
1. **Express**：基于Node.js的Web应用开发框架，用于快速搭建后端服务器，处理HTTP请求和响应。
2. **MySQL**：关系型数据库，用于存储系统的各类数据，如用户信息、物资信息、药品信息、人员信息、体检信息以及操作记录等。

## 三、数据库设计
### 1. 用户表 (users)
| 字段名 | 类型 | 描述 |
| --- | --- | --- |
| id | INT | 用户唯一标识，主键，自增长 |
| username | VARCHAR(50) | 用户名 |
| password | VARCHAR(100) | 密码（加密存储） |
| email | VARCHAR(100) | 邮箱 |
| role | ENUM('admin', 'normal') | 用户角色，管理员或普通用户 |

### 2. 物资表 (supplies)
| 字段名 | 类型 | 描述 |
| --- | --- | --- |
| id | INT | 物资唯一标识，主键，自增长 |
| supply_name | VARCHAR(100) | 物资名称，对应原表`物资名称` |
| storage_location | VARCHAR(200) | 存放位置，对应原表`存放位置` |
| production_date | DATE | 生产日期，对应原表`生产日期` |
| validity_period_days | INT | 有效期（天），对应原表`有效期（天）` |
| supply_number | INT | 编号，对应原表`编号` |
| expiration_date | DATE | 过期时间，通过`production_date + INTERVAL validity_period_days DAY`计算得出 |

### 3. 药品表 (medicines)
| 字段名 | 类型 | 描述 |
| --- | --- | --- |
| id | INT | 药品唯一标识，主键，自增长 |
| medicine_name | VARCHAR(100) | 药品名称，对应原表`药品名称` |
| storage_location | VARCHAR(200) | 存放位置，对应原表`存放位置` |
| production_date | DATE | 生产日期，对应原表`生产日期` |
| validity_period_days | INT | 有效期（天），对应原表`有效期（天）` |
| quantity | INT | 数量，对应原表`数量` |
| expiration_date | DATE | 过期时间，通过`production_date + INTERVAL validity_period_days DAY`计算得出 |

### 4. 人员表 (employees)
| 字段名 | 类型 | 描述 |
| --- | --- | --- |
| id | INT | 人员唯一标识，主键，自增长 |
| name | VARCHAR(100) | 姓名，对应原表`姓名` |
| employee_number | INT | 员工工号，对应原表`员工工号`，作为与体检信息表关联的字段 |
| gender | ENUM('男', '女') | 性别，对应原表`性别` |
| workshop | VARCHAR(100) | 车间，对应原表`车间` |
| position | VARCHAR(100) | 岗位，对应原表`岗位` |

### 5. 体检信息表 (medical_examinations)
| 字段名 | 类型 | 描述 |
| --- | --- | --- |
| id | INT | 体检信息唯一标识，主键，自增长 |
| employee_number | INT | 工号，对应原表`工号`，作为与人员表关联的字段 |
| examination_date | DATE | 体检日期，对应原表`体检日期` |
| audiometry_result | VARCHAR(50) | 电测听体检结果，对应原表`电测听体检结果` |
| dust_examination_result | VARCHAR(50) | 粉尘体检结果，对应原表`粉尘体检结果` |
| need_recheck | INT | 是否复查，对应原表`是否复查` |
| recheck_date | DATE | 复查日期，对应原表`复查日期` |
| audiometry_recheck_result | VARCHAR(50) | 电测听复查结果，对应原表`电测听复查结果` |
| dust_recheck_result | VARCHAR(50) | 粉尘复查结果，对应原表`粉尘复查结果` |

## 四、前后端API规范
### 前端向后端发送的请求
#### 1. 用户相关
- **注册**
  - **请求方法**：POST
  - **请求路径**：/api/users/register
  - **请求体**：
```json
{
  "username": "string",
  "password": "string",
  "email": "string",
  "role": "string"
}
```
- **登录**
  - **请求方法**：POST
  - **请求路径**：/api/users/login
  - **请求体**：
```json
{
  "username": "string",
  "password": "string"
}
```
- **获取用户信息（需认证）**
  - **请求方法**：GET
  - **请求路径**：/api/users/me
  - **请求头**：Authorization: Bearer [token]

#### 2. 物资相关
- **添加物资（需认证）**
  - **请求方法**：POST
  - **请求路径**：/api/supplies
  - **请求体**：
```json
{
  "supply_name": "string",
  "storage_location": "string",
  "production_date": "string",
  "validity_period_days": "number",
  "supply_number": "number"
}
```
后端在接收到该请求时，会自动计算`expiration_date`并存储。
- **获取物资列表（需认证）**
  - **请求方法**：GET
  - **请求路径**：/api/supplies
  - **请求头**：Authorization: Bearer [token]

#### 3. 药品相关
- **添加药品（需认证）**
  - **请求方法**：POST
  - **请求路径**：/api/medicines
  - **请求体**：
```json
{
  "medicine_name": "string",
  "storage_location": "string",
  "production_date": "string",
  "validity_period_days": "number",
  "quantity": "number"
}
```
后端在接收到该请求时，会自动计算`expiration_date`并存储。
- **获取药品列表（需认证）**
  - **请求方法**：GET
  - **请求路径**：/api/medicines
  - **请求头**：Authorization: Bearer [token]

#### 4. 人员相关
- **添加人员（需认证）**
  - **请求方法**：POST
  - **请求路径**：/api/employees
  - **请求体**：
```json
{
  "name": "string",
  "employee_number": "number",
  "gender": "string",
  "workshop": "string",
  "position": "string"
}
```
- **获取人员列表（需认证）**
  - **请求方法**：GET
  - **请求路径**：/api/employees
  - **请求头**：Authorization: Bearer [token]

#### 5. 体检信息相关
- **添加体检信息（需认证）**
  - **请求方法**：POST
  - **请求路径**：/api/medical_examinations
  - **请求体**：
```json
{
  "employee_number": "number",
  "examination_date": "string",
  "audiometry_result": "string",
  "dust_examination_result": "string",
  "need_recheck": "number",
  "recheck_date": "string",
  "audiometry_recheck_result": "string",
  "dust_recheck_result": "string"
}
```
- **获取体检信息列表（需认证）**
  - **请求方法**：GET
  - **请求路径**：/api/medical_examinations
  - **请求头**：Authorization: Bearer [token]
  - 当需要获取与特定人员相关的体检信息时，可以在请求参数中添加`employee_number`，如`/api/medical_examinations?employee_number=123`。

#### 6. 操作记录相关
- **获取操作记录列表（需认证）**
  - **请求方法**：GET
  - **请求路径**：/api/operation_records
  - **请求头**：Authorization: Bearer [token]

### 后端向前端返回的响应
- **成功响应**：
```json
{
  "success": true,
  "data": [具体数据]
}
```
- **失败响应**：
```json
{
  "success": false,
  "message": "错误信息"
}
```

## 五、前端界面设计
### 登录/注册页面
使用Ant Design的表单组件实现登录和注册功能，包括用户名、密码、邮箱等输入框，以及提交按钮。

### 主界面
1. **导航栏**：包含用户信息展示、退出登录按钮等。
2. **侧边栏**：用于切换不同的管理模块，如物资管理、药品管理、人员管理、体检信息管理等。
3. **图表区域**：使用Ant Design的图表组件或第三方图表库（如ECharts）展示各类数据的统计图表，如物资数量分布、药品过期情况等。这里可以增加展示物资和药品过期时间的相关图表。
4. **时间轴区域**：展示用户的操作记录时间轴，使用Ant Design的时间轴组件实现。

### 各管理模块页面
使用表格组件展示对应的数据列表，并提供添加、编辑、删除等操作按钮。添加和编辑功能使用表单组件实现。在人员管理和体检信息管理页面，可以增加关联查询的功能，方便查看特定人员的体检信息。

## 六、后端实现逻辑
### 认证与授权
使用JSON Web Tokens (JWT)进行用户认证。用户登录成功后，后端生成JWT并返回给前端，前端在后续请求中将JWT放在请求头的Authorization字段中。后端中间件验证JWT的有效性，并根据用户角色进行权限控制。

### 数据操作
根据前端的请求，后端对MySQL数据库进行相应的增、删、改、查操作。例如，当接收到添加物资的请求时，将物资信息插入到物资表中，并自动计算`expiration_date`。当处理体检信息相关请求时，通过`employee_number`与人员表进行关联查询或操作。

### 数据库连接信息
host:'117.72.123.17',
user:'fanjk-ward',
password:'xiaokai123',
database:'ward',
port:'3306'

### 操作记录
在后端处理每个请求时，记录用户的操作类型、操作时间和操作详情到操作记录表中。

## 七、开发流程
1. **数据库搭建**：根据数据库设计创建MySQL数据库和相应的表。特别注意物资表和药品表中`expiration_date`字段的计算逻辑在数据库层面的实现。
2. **后端开发**：使用Express框架实现API接口，处理前端的各类请求，与MySQL数据库进行交互。
3. **前端开发**：使用React和Ant Design 5.0 UI库构建用户界面，实现与后端API的交互。重点实现各模块间的关联查询功能以及图表展示。
4. **集成测试**：将前端和后端进行集成测试，确保系统的各项功能正常运行。
5. **优化与部署**：对系统进行性能优化，并部署到生产环境。 